<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factor F Calculator - Method of Calculation</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --navy: #003366; --red: #d32f2f; --grey: #f8f9fa; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; padding: 20px; line-height: 1.6; }
        .container { max-width: 850px; margin: auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* Header */
        .header { text-align: center; border-bottom: 2px solid var(--navy); margin-bottom: 30px; padding-bottom: 10px; }
        .header h2 { color: var(--navy); margin: 0; }

        /* Form Section */
        .card { background: var(--grey); padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #e0e0e0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        label { font-weight: bold; font-size: 0.9em; color: #555; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

        /* Calculation Display */
        .result-section { display: none; margin-top: 30px; animation: fadeIn 0.5s; }
        .formula-display { background: #fffbe6; border: 1px solid #ffe58f; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .math-line { display: flex; align-items: center; justify-content: center; font-family: 'Courier New', Courier, monospace; font-size: 1.1em; overflow-x: auto; }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        table th, table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        table th { background: #f2f2f2; }
        .text-right { text-align: right; font-weight: bold; }
        .final-box { text-align: center; padding: 20px; background: var(--navy); color: white; border-radius: 8px; margin-top: 20px; }
        .final-box h1 { margin: 0; font-size: 3em; }

        /* Buttons */
        .btn { cursor: pointer; border: none; border-radius: 4px; padding: 12px 20px; font-weight: bold; transition: 0.3s; width: 100%; font-size: 1.1em; }
        .btn-main { background: var(--navy); color: white; }
        .btn-print { background: #6c757d; color: white; margin-top: 10px; }
        .btn:hover { opacity: 0.9; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media print {
            .no-print { display: none; }
            .container { box-shadow: none; width: 100%; padding: 0; }
            .result-section { display: block !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>แสดงวิธีคำนวณค่า Factor F (ว 499)</h2>
    </div>

    <div class="no-print">
        <div class="card">
            <div class="grid">
                <div>
                    <label>ประเภทงาน</label>
                    <select id="workType">
                        <option value="road">งานทาง</option>
                        <option value="building">งานอาคาร</option>
                        <option value="bridge">งานสะพาน</option>
                    </select>
                </div>
                <div>
                    <label>ค่างานต้นทุน (A) - บาท</label>
                    <input type="number" id="costA" step="0.01" placeholder="8,374,254.61">
                </div>
            </div>
        </div>
        <button class="btn btn-main" onclick="processCalc()">เริ่มการคำนวณและแสดงวิธีทำ</button>
    </div>

    <div id="resultOutput" class="result-section">
        <h3>1. ตารางข้อมูลอ้างอิง</h3>
        <table>
            <tr><td>ค่างานต้นทุน (A)</td><td class="text-right" id="valA"></td></tr>
            <tr><td>ช่วงค่างานต้นทุนต่ำกว่า (B)</td><td class="text-right" id="valB"></td></tr>
            <tr><td>ช่วงค่างานต้นทุนสูงกว่า (C)</td><td class="text-right" id="valC"></td></tr>
            <tr><td>ค่า Factor F ของช่วงต่ำ (D)</td><td class="text-right" id="valD"></td></tr>
            <tr><td>ค่า Factor F ของช่วงสูง (E)</td><td class="text-right" id="valE"></td></tr>
        </table>

        <h3>2. วิธีการคำนวณ (Interpolation)</h3>
        <p>ใช้สูตรการเทียบอัตราส่วน: $Factor F = D - \left[ \frac{(D - E) \times (A - B)}{C - B} \right]$</p>
        
        <div class="formula-display">
            <strong>ขั้นตอนการแทนค่า:</strong><br>
            F = <span class="d-val">D</span> - [ (<span class="d-val">D</span> - <span class="e-val">E</span>) × (<span class="a-val">A</span> - <span class="b-val">B</span>) / (<span class="c-val">C</span> - <span class="b-val">B</span>) ]<br><br>
            
            F = <span id="stepD"></span> - [ (<span id="stepD2"></span> - <span id="stepE"></span>) × (<span id="stepAMB"></span>) / (<span id="stepCMB"></span>) ]<br>
            F = <span id="stepD3"></span> - [ <span id="stepDiffF"></span> × <span id="stepRatio"></span> ]
        </div>

        <div class="final-box">
            <small>ค่า Factor F ที่ได้</small>
            <h1 id="finalResult"></h1>
        </div>

        <button class="btn btn-print no-print" onclick="window.print()">พิมพ์เป็น PDF เพื่อแนบรายงาน</button>
    </div>
</div>

<script>
// ข้อมูลจำลอง (ตัวอย่างงานทาง 15-10-7%)
const lookupTable = [
    {cost: 5000000, f: 1.3616},
    {cost: 10000000, f: 1.3105},
    {cost: 20000000, f: 1.2521}
];

function processCalc() {
    const A = parseFloat(document.getElementById('costA').value);
    if (!A) return alert("กรุณากรอกค่างานต้นทุน");

    let B, C, D, E;
    
    // ค้นหาช่วงในตาราง
    for(let i=0; i<lookupTable.length-1; i++) {
        if(A >= lookupTable[i].cost && A <= lookupTable[i+1].cost) {
            B = lookupTable[i].cost;
            C = lookupTable[i+1].cost;
            D = lookupTable[i].f;
            E = lookupTable[i+1].f;
            break;
        }
    }

    // คำนวณ
    const diffF = D - E;
    const diffA = A - B;
    const range = C - B;
    const ratio = diffA / range;
    const finalF = D - (diffF * ratio);

    // แสดงผลข้อมูลพื้นฐาน
    document.getElementById('valA').innerText = A.toLocaleString(undefined, {minimumFractionDigits: 2});
    document.getElementById('valB').innerText = B.toLocaleString();
    document.getElementById('valC').innerText = C.toLocaleString();
    document.getElementById('valD').innerText = D.toFixed(4);
    document.getElementById('valE').innerText = E.toFixed(4);

    // แสดงขั้นตอนวิธีทำ
    document.getElementById('stepD').innerText = D.toFixed(4);
    document.getElementById('stepD2').innerText = D.toFixed(4);
    document.getElementById('stepD3').innerText = D.toFixed(4);
    document.getElementById('stepE').innerText = E.toFixed(4);
    document.getElementById('stepAMB').innerText = diffA.toLocaleString(undefined, {minimumFractionDigits: 2});
    document.getElementById('stepCMB').innerText = range.toLocaleString();
    document.getElementById('stepDiffF').innerText = diffF.toFixed(4);
    document.getElementById('stepRatio').innerText = ratio.toFixed(6);

    document.getElementById('finalResult').innerText = finalF.toFixed(4);
    document.getElementById('resultOutput').style.display = 'block';
}
</script>

</body>
</html>
