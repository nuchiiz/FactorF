<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factor F Calculator - Professional Edit</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a73e8; --secondary: #5f6368; --success: #2e7d32; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; display: flex; justify-content: center; padding: 20px; color: #3c4043; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 650px; }
        h2 { color: var(--primary); text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; color: var(--secondary); font-size: 0.85em; margin-bottom: 20px; }
        
        /* Layout */
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; font-size: 0.9em; }
        select, input { width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 6px; font-size: 15px; box-sizing: border-box; }
        
        /* Result Styling */
        .result-box { margin-top: 25px; padding: 20px; border: 2px solid var(--primary); border-radius: 10px; background: #fff; display: none; }
        .final-val { font-size: 42px; color: #d93025; font-weight: bold; text-align: center; margin: 10px 0; }
        
        .btn-main { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-sub { padding: 10px; border: 1px solid #dadce0; border-radius: 5px; cursor: pointer; font-family: inherit; }

        @media print { .no-print { display: none; } .card { box-shadow: none; width: 100%; } .result-box { display: block !important; } }
    </style>
</head>
<body>

<div class="card">
    <div class="no-print">
        <h2>Factor F Calculator</h2>
        <p class="subtitle">คำนวณค่า Factor F ตามเกณฑ์ราคากลางงานก่อสร้าง</p>

        <div class="grid-3">
            <div class="form-group">
                <label>เงินล่วงหน้า (%)</label>
                <select id="advance">
                    <option value="0">0%</option>
                    <option value="5">5%</option>
                    <option value="10">10%</option>
                    <option value="15" selected>15%</option>
                </select>
            </div>
            <div class="form-group">
                <label>เงินประกัน (%)</label>
                <input type="number" id="retention" value="10">
            </div>
            <div class="form-group">
                <label>ดอกเบี้ยกู้ (%)</label>
                <input type="number" id="interest" value="5">
            </div>
        </div>

        <div class="grid-3">
            <div class="form-group" style="grid-column: span 2;">
                <label>ประเภทงาน</label>
                <select id="workType">
                    <option value="road">งานทาง</option>
                    <option value="bridge">งานสะพานและท่อเหลี่ยม</option>
                    <option value="irrigation">งานชลประทาน</option>
                </select>
            </div>
            <div class="form-group">
                <label>VAT (%)</label>
                <input type="number" id="vat" value="7">
            </div>
        </div>

        <div class="form-group">
            <label>ค่างานต้นทุน (A) - บาท</label>
            <input type="number" id="costA" placeholder="ระบุค่างาน เช่น 8374254.61">
        </div>

        <button class="btn-main" onclick="calculate()">คำนวณค่า Factor F</button>
    </div>

    <div id="resultArea" class="result-box">
        <h3 style="text-align:center; margin-top:0;">ผลการคำนวณ</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; font-size: 0.9em;">
            <p><b>ประเภทงาน:</b> <span id="resWork"></span></p>
            <p><b>เงินล่วงหน้า:</b> <span id="resAdv"></span>%</p>
            <p><b>เงินประกัน:</b> <span id="resRet"></span>%</p>
            <p><b>ดอกเบี้ย:</b> <span id="resInt"></span>%</p>
            <p><b>VAT:</b> <span id="resVat"></span>%</p>
            <p><b>ต้นทุน (A):</b> <span id="resA"></span></p>
        </div>
        <hr>
        <div class="final-val" id="finalF">1.0000</div>
        <div style="text-align:center; color: #666; font-size: 0.8em;">(ใช้สำหรับการคูณกับค่างานต้นทุนเพื่อหาค่างานสุทธิ)</div>
        
        <div class="action-btns no-print">
            <button class="btn-sub" onclick="copyResult()">คัดลอกข้อความ</button>
            <button class="btn-sub" onclick="window.print()">พิมพ์เอกสาร / PDF</button>
        </div>
    </div>
</div>

<script>
// หมายเหตุ: ในทางปฏิบัติ ค่า Factor F จะเปลี่ยนตาม Interest และ Retention ด้วย 
// ในโค้ดนี้จะใช้ฐานข้อมูลจากตารางมาตรฐาน (Interest 5, Retention 10) เป็นหลัก
// หากค่าเหล่านี้เปลี่ยนไป "อย่างมีนัยสำคัญ" ผู้ใช้ควรปรับตารางข้อมูลใน factorData
const factorData = {
    road: {
        "15": [{c:5e6, f:1.3616}, {c:1e7, f:1.3105}, {c:2e7, f:1.3005}, {c:5e7, f:1.2915}],
        "10": [{c:5e6, f:1.3640}, {c:1e7, f:1.3130}, {c:2e7, f:1.3030}, {c:5e7, f:1.2940}],
        "5":  [{c:5e6, f:1.3665}, {c:1e7, f:1.3155}, {c:2e7, f:1.3055}, {c:5e7, f:1.2965}],
        "0":  [{c:5e6, f:1.3690}, {c:1e7, f:1.3180}, {c:2e7, f:1.3080}, {c:5e7, f:1.2990}]
    },
    bridge: {
        "15": [{c:5e6, f:1.3161}, {c:1e7, f:1.2801}, {c:2e7, f:1.2701}, {c:5e7, f:1.2415}],
        "10": [{c:5e6, f:1.3185}, {c:1e7, f:1.2825}, {c:2e7, f:1.2725}, {c:5e7, f:1.2440}],
        "5":  [{c:5e6, f:1.3210}, {c:1e7, f:1.2850}, {c:2e7, f:1.2750}, {c:5e7, f:1.2465}],
        "0":  [{c:5e6, f:1.3235}, {c:1e7, f:1.2875}, {c:2e7, f:1.2775}, {c:5e7, f:1.2490}]
    },
    irrigation: {
        "15": [{c:5e6, f:1.4055}, {c:1e7, f:1.3851}, {c:2e7, f:1.3751}, {c:5e7, f:1.3524}],
        "10": [{c:5e6, f:1.4080}, {c:1e7, f:1.3875}, {c:2e7, f:1.3775}, {c:5e7, f:1.3550}],
        "5":  [{c:5e6, f:1.4105}, {c:1e7, f:1.3900}, {c:2e7, f:1.3800}, {c:5e7, f:1.3575}],
        "0":  [{c:5e6, f:1.4130}, {c:1e7, f:1.3925}, {c:2e7, f:1.3825}, {c:5e7, f:1.3600}]
    }
};

function calculate() {
    const A = parseFloat(document.getElementById('costA').value);
    const type = document.getElementById('workType').value;
    const adv = document.getElementById('advance').value;
    const vat = parseFloat(document.getElementById('vat').value);
    
    if (!A) { alert("กรุณากรอกค่างานต้นทุน"); return; }

    const table = factorData[type][adv];
    let B, C, D, E;

    if (A <= table[0].c) { B = C = table[0].c; D = E = table[0].f; }
    else if (A >= table[table.length-1].c) { B = C = table[table.length-1].c; D = E = table[table.length-1].f; }
    else {
        for (let i = 0; i < table.length - 1; i++) {
            if (A >= table[i].c && A <= table[i+1].c) {
                B = table[i].c; D = table[i].f;
                C = table[i+1].c; E = table[i+1].f;
                break;
            }
        }
    }

    let resultF = (B === C) ? D : D - (((D - E) * (A - B)) / (C - B));
    
    // ปรับค่าตาม VAT หากไม่ใช่ 7% (สูตรโดยประมาณ: F_new = F_old * (1+Vat_new)/(1+0.07))
    if (vat !== 7) {
        resultF = resultF * (1 + (vat/100)) / 1.07;
    }

    document.getElementById('resWork').innerText = document.getElementById('workType').selectedOptions[0].text;
    document.getElementById('resAdv').innerText = adv;
    document.getElementById('resRet').innerText = document.getElementById('retention').value;
    document.getElementById('resInt').innerText = document.getElementById('interest').value;
    document.getElementById('resVat').innerText = vat;
    document.getElementById('resA').innerText = A.toLocaleString();
    document.getElementById('finalF').innerText = resultF.toFixed(4);
    document.getElementById('resultArea').style.display = 'block';
}

function copyResult() {
    const f = document.getElementById('finalF').innerText;
    const a = document.getElementById('resA').innerText;
    navigator.clipboard.writeText(`ค่างานต้นทุน: ${a} บาท, Factor F: ${f}`);
    alert("คัดลอกข้อมูลแล้ว");
}
</script>
</body>
</html>
